/*
  backgrid-query-select
  http://github.com/natearmagost/backgrid-query-select

  Copyright (c) 2015 Nate Armagost
  Licensed under the MIT @license.
*/
!function(a,b){"use strict";"object"==typeof exports?module.exports=b(require("underscore"),require("backbone"),require("backgrid"),require("backbone.paginator")):"function"==typeof define&&define.amd?define(["underscore","backbone","backgrid","backbone.paginator"],b):b(a._,a.Backbone,a.Backgrid)}(this,function(a,b,c){"use strict";c.Extension.QuerySelect=b.View.extend({tagName:"select",template:a.template('<% _.each(options, function(option) { %> <option value="<%= option.value %>"<% if (option.label) { %> label="<%= option.label %>"<% } %><% if (option.selected) { %> selected<% } %><% if (option.disabled) { %> disabled<% } %>><%= option.text %></option><% }); %>'),events:{change:"changeOption"},selectBox:{options:[]},queryParam:null,initialize:function(c){if(this.selectBox=a.defaults(c.selectBox||{},this.selectBox),this.queryParam=c.queryParam,!(b.PageableCollection&&this.collection instanceof b.PageableCollection))throw"backbone.paginator is required";if("client"===this.collection.mode)throw'"server" or "infinite" mode is required';if(!this.queryParam)throw"A query parameter is required";var d=a.where(this.selectBox.options,{selected:!0});if(d.length>1)throw"A maximum of 1 item should be marked as selected";window.console&&0===d.length&&this.selectBox.options.length&&this.selectBox.options[0].value!==this.collection.queryParams[this.queryParam]&&console.warn("The default option's value does not match collection's queryParam value"),window.console&&1===d.length&&d[0].value!==this.collection.queryParams[this.queryParam]&&console.warn("The selected option's value does not match the collection's queryParam value")},render:function(){return this.$el.empty().append(this.template(this.selectBox)),this},changeOption:function(b){var c=$(b.currentTarget).val();a.each(a.where(this.selectBox.options,{selected:!0}),function(a){delete a.selected}),a.where(this.selectBox.options,{value:c})[0].selected=!0,""===c?delete this.collection.queryParams[this.queryParam]:this.collection.queryParams[this.queryParam]=c,this.collection.getFirstPage()}})});